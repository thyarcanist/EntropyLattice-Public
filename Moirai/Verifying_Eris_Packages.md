# Verifying Eris Quantum Data Package Integrity

## Background

This document provides instructions on how to verify the integrity of quantum data packages generated by the Eris Quantum Random Number Generator (QRNG). Similar to how users can verify the processing of dice rolls for hardware wallets like Coldcard, this process allows recipients of Eris data packages to confirm that the provided files (`quantum_raw.bin`, `quantum_whitened.bin`) are exactly as generated by the service and have not been altered or corrupted during transmission or storage.

Verification relies on comparing SHA-256 cryptographic hashes. Each package includes a `verification.txt` file which contains the official SHA-256 hashes calculated for the data files at the moment they were generated. By independently recalculating these hashes on the files you received, you can ensure their authenticity and integrity.

## Understanding the Package Contents

When you receive or download an Eris Quantum Data Package (typically a directory named `quantum_package_<timestamp>` or similar, like the included `Moirai_QuantumBinDemo` example), you will generally find the following key components:

1.  **`quantum_whitened.bin`:** This is the primary file containing the quantum random data that has undergone a whitening process (like XOR-CASCADE + TOEPLITZ MATRIX for `eris:full`) to improve statistical properties.
2.  **`quantum_raw.bin` (Optional):** Some packages may also include the raw, unwhitened data as captured from the quantum source. Its presence depends on the generation settings.
3.  **`verification.txt`:** This crucial text file contains metadata about the package and, most importantly, the official SHA-256 hash values for `quantum_raw.bin` (if included) and `quantum_whitened.bin`, recorded at the time of generation.
4.  **`quality_report/` (Optional Directory):** If an audit was performed during generation, this subdirectory may contain:
    *   `entropy_audit_<timestamp>.yaml`: A YAML file summarizing the results of statistical randomness tests.
    *   `entropy_viz_<timestamp>.png`: A visualization generated during the audit.

The primary purpose of this document is to verify the integrity of the `.bin` files using the hashes stored in `verification.txt`.

## Verifying Package Integrity

There are two primary methods to verify the integrity: using standard command-line tools or using the provided Python script.

### Method 1: Using Command-Line Tools

You can use built-in tools on most operating systems to calculate the SHA-256 hashes.

**Linux / macOS:**

```bash
# Navigate to the package directory
cd path/to/your/quantum_package_...

# Calculate hash for whitened data
sha256sum quantum_whitened.bin

# Calculate hash for raw data (if present)
sha256sum quantum_raw.bin 
```

**Windows (PowerShell):**

```powershell
# Navigate to the package directory
cd path\to\your\quantum_package_...

# Calculate hash for whitened data
CertUtil -hashfile .\quantum_whitened.bin SHA256

# Calculate hash for raw data (if present)
CertUtil -hashfile .\quantum_raw.bin SHA256
```

**Comparison:**

After running the appropriate command(s), manually compare the output hash value(s) with the corresponding `SHA-256 (Whitened):` and `SHA-256 (Raw):` values listed inside the `verification.txt` file within the same directory. The hashes must match exactly.

### Method 2: Using the Verification Script (`verify_package_integrity.py`)

A Python script is provided within this `Moirai` directory to automate the verification process.

**Requirements:**

*   Python 3.x

**Usage:**

1.  Open your terminal or command prompt.
2.  Navigate to the root directory of the Idia project (the directory containing the `Moirai` folder).
3.  Run the script, providing the path to the quantum package directory you want to verify as a command-line argument.

```bash
# Example:
python Moirai/verify_package_integrity.py QuantumDataService/packages/quantum_package_20250331_20250331_161630 
```

**Output:**

The script will:

1.  Confirm the existence of `verification.txt` and `quantum_whitened.bin`.
2.  Check for `quantum_raw.bin`.
3.  Parse the expected hashes from `verification.txt`.
4.  Calculate the actual SHA-256 hashes of the `.bin` files present.
5.  Compare the expected and actual hashes.
6.  Print a clear summary indicating PASS or FAIL for each file and an overall verification status.

Example Successful Output:

```
--- Verifying Package Integrity: quantum_package_20250331_20250331_161630 ---
INFO: Optional file 'quantum_raw.bin' not found. Skipping raw data check.

[1] Parsing verification.txt...
INFO: Found expected Raw SHA256: <expected_raw_hash>
INFO: Found expected Whitened SHA256: <expected_whitened_hash>

[2] Calculating actual file hashes...
  Calculated Whitened SHA256: <actual_whitened_hash>
  WARNING: Expected raw hash found but raw file does not exist. Cannot check.

[3] Comparing Hashes...
  Whitened Data (quantum_whitened.bin): MATCH -> PASS
  Raw Data      (quantum_raw.bin): SKIPPED (File not found)

--- Overall Package Integrity Verification: PASS --- 
```

Example Failed Output:

```
--- Verifying Package Integrity: quantum_package_tampered_example ---

[1] Parsing verification.txt...
INFO: Found expected Raw SHA256: <expected_raw_hash>
INFO: Found expected Whitened SHA256: <expected_whitened_hash>

[2] Calculating actual file hashes...
  Calculated Whitened SHA256: <different_actual_whitened_hash>
  Calculated Raw SHA256:       <actual_raw_hash>

[3] Comparing Hashes...
  Whitened Data (quantum_whitened.bin): MISMATCH -> FAIL
    Expected: <expected_whitened_hash>
    Actual:   <different_actual_whitened_hash>
  Raw Data      (quantum_raw.bin): MATCH -> PASS

--- Overall Package Integrity Verification: FAIL --- 
```

The script will exit with code 0 on PASS and code 1 on FAIL.

## Security Considerations

*   **Trusted Environment:** For maximum security, perform these verification steps in a trusted computing environment, similar to the recommendations for verifying hardware wallet seeds (e.g., an air-gapped machine or a secure live OS like Tails, especially if the data is highly sensitive).
*   **Source of Script:** Ensure you are using the `verify_package_integrity.py` script obtained directly from the official Eris/Idia project source to avoid running malicious code.
*   **Scope:** This process verifies that the data files *match the hashes recorded at the time of generation*. It does not, by itself, re-validate the *quality* of the randomness (which is the purpose of the entropy audit tools).